short GetEvent (Pt * ppos){  long key, maj;  *ppos = lastmouse;		/* rend la dernire position de la souris */  N_settim (0);			/* met un timeout nul */  key = L_getkey ();		/* lecture du clavier sans attendre */  N_settim (0xFFFF);		/* remet un timeout infini */  lastmouse = getmousepos ();	/* lit la position de la souris */  if (errno)    return 0;			/* retourne si timeout */  if (key >> 16 == 'D')    keystatus = STLEFT;  if (key >> 16 == 'F')    keystatus = STRIGHT;  if (key >> 16 == 'R')    keystatus = STUP;  if (key >> 16 == 'C')    keystatus = STDOWN;  if (key & 0x8000)		/* touche relche ? */    {      if (key >> 16 == ('D' | 0x80))	keystatus &= ~STLEFT;      if (key >> 16 == ('F' | 0x80))	keystatus &= ~STRIGHT;      if (key >> 16 == ('R' | 0x80))	keystatus &= ~STUP;      if (key >> 16 == ('C' | 0x80))	keystatus &= ~STDOWN;      return 0;			/* retourne si pas touche presse */    }  maj = key & 0xFF;  if (maj >= 'a' && maj <= 'z')    maj -= 'a' - 'A';  if (typetext == 0)    {      if (key >> 16 == 'D')	return KEYLEFT;      if (key >> 16 == 'F')	return KEYRIGHT;      if (key >> 16 == 'R')	return KEYUP;      if (key >> 16 == 'C')	return KEYDOWN;    }  else    {      if ((key & 0xFF00) == (KCURSOR << 8))	{	  if (maj == 'D')	    return KEYLEFT;	  if (maj == 'F')	    return KEYRIGHT;	  if (maj == 'R')	    return KEYUP;	  if (maj == 'C')	    return KEYDOWN;	  return 0;	}    }  key &= 0xFFFF;  if (key == KEYMPO)    return 0;  if (key == F0)    return KEYQUIT;  if (key == F1)    return KEYF1;  if (key == F2)    return KEYF2;  if (key == F3)    return KEYF3;  if (key == F4)    return KEYF4;  if (key == F5)    return KEYF5;  if (key == F6)    return KEYF6;  if (key == F7)    return KEYF7;  if (key == F8)    return KEYF8;  if (key == F9)    return KEYF9;  if (key == F10)    return KEYF10;  if (key == F11)    return KEYF11;  if (key == F12)    return KEYF12;  if (key == F13)    return KEYSAVE;  if (key == F14)    return KEYLOAD;  if (key == F15)    return KEYPAUSE;  if (key == END)    return KEYHOME;  if (key == DEFINE)    return KEYDEF;  if (key == UNDO)    return KEYUNDO;  if (key == DEL)    return KEYDEL;  if (key == CR)    return KEYRETURN;  if (key == ENTER)    return KEYENTER;  if (key == POINT)    return KEYCENTER;  if (key == KEYMGP)    return KEYCLIC;  if (key == KEYMMP)    return KEYCLIC;  if (key == KEYMDP)    return KEYCLICR;  if (key == KEYMGR)    return KEYCLICREL;  if (key == KEYMMR)    return KEYCLICREL;  if (key == KEYMDR)    return KEYCLICREL;  if (typetext == 1)    {      if (key == '')	return KEYCIRCON;      if (key == '')	return KEYTREMA;      if (key == '')	return KEYAGRAVE;      if (key == '')	return KEYATREMA;      if (key == '')	return KEYEAIGU;      if (key == '')	return KEYEGRAVE;      if (key == '')	return KEYOTREMA;      if (key == '')	return KEYUGRAVE;      if (key == '')	return KEYUTREMA;      if (key == '')	return KEYCCEDILLE;    }  return (short) key;}